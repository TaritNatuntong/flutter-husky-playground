# #!/bin/sh
# # ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå Husky (‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö)
# . "$(dirname "$0")/_/husky.sh"

# # 1. ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ß‡∏¢‡πÜ ‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
# echo "------------------------------------------------"
# echo "üê∂ Husky is watching you..."
# echo "------------------------------------------------"

# # 2. ‡∏à‡∏±‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î (Format) ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
# echo "‚ú® Running Dart Format..."
# dart format .

# # 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Syntax (Analyze) - ‡∏ñ‡πâ‡∏≤‡∏û‡∏±‡∏á ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î Commit
# echo "üîç Running Flutter Analyze..."
# flutter analyze
# if [ $? -ne 0 ]; then
#   echo "‚ùå Error: Code analysis failed! Please fix issues."
#   exit 1
# fi

# # 4. (‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) ‡∏£‡∏±‡∏ô Unit Test - ‡∏ñ‡πâ‡∏≤‡∏£‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î Commit
# # echo "üß™ Running Tests..."
# # flutter test
# # if [ $? -ne 0 ]; then
# #   echo "‚ùå Error: Tests failed!"
# #   exit 1
# # fi

# echo "‚úÖ All checks passed! Committing now..."
# echo "------------------------------------------------"

#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "üê∂ Husky: Manual checking on STAGED files..."

# 1. ‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå .dart ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å Staged (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà Add ‡∏°‡∏≤)
# - diff --cached --name-only : ‡∏î‡∏π‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô staging area
# - diff --diff-filter=ACMR : ‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà Add, Copy, Modify, Rename (‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏≤ Deleted)
# - grep .dart$ : ‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ .dart
staged_dart_files=$(git diff --cached --name-only --diff-filter=ACMR | grep ".dart$")

# 2. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå Dart ‡πÑ‡∏´‡∏°? (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡πá‡∏à‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏¢)
if [ -z "$staged_dart_files" ]; then
  echo "‚ú® No Dart files changed. Skipping checks."
  exit 0
fi

# ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏≤‡∏Å‡∏î‡∏π)
echo "üìù Checking these files:"
echo "$staged_dart_files"

# ---------------------------------------------------------
# 3. ‡∏£‡∏±‡∏ô Dart Format (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)
# ---------------------------------------------------------
echo "\n‚ú® Running Dart Format..."
# $staged_dart_files ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô list ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
dart format $staged_dart_files

# ‡∏ñ‡πâ‡∏≤ format ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á add ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢ (Optional logic)
# (‡πÅ‡∏ï‡πà‡∏õ‡∏Å‡∏ï‡∏¥ dart format ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß save ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏£‡∏≤‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á git add ‡∏ã‡πâ‡∏≥‡πÄ‡∏≠‡∏á‡∏ñ‡πâ‡∏≤‡∏£‡∏±‡∏ô‡πÉ‡∏ô‡∏ô‡∏µ‡πâ)

# ---------------------------------------------------------
# 4. ‡∏£‡∏±‡∏ô Flutter Analyze (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)
# ---------------------------------------------------------
echo "\nüîç Running Flutter Analyze..."
flutter analyze $staged_dart_files

# ‡πÄ‡∏Å‡πá‡∏ö Exit Code ‡∏Ç‡∏≠‡∏á Analyze ‡πÑ‡∏ß‡πâ
analyze_exit_code=$?

# 5. ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à (Pass / Fail)
if [ $analyze_exit_code -ne 0 ]; then
  echo "\n‚ùå Analyze Failed! Please fix issues in the staged files."
  exit 1
fi

echo "\n‚úÖ All checks passed!"
exit 0